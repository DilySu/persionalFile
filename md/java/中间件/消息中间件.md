## 一、什么是中间件

1. 利用可靠的消息传递机制进行系统和系统之间的通讯
2. 通过提供消息传递和消息的排队机制，它可以在分布式系统环境下扩展进程间的通讯

本质：一种接收数据、存储数据、发送数据等功能的技术服务

## 二、常见的消息中间件

### 2.1 ActiveMQ

渐渐被淘汰，不建议使用

### 2.2 RabbitMQ 

吞吐量较大，目前比较流行，是 Spring 开发团队研发，和 Spring 有良好的兼容性，非常稳定，适合于中小型项目，不适合分布式

### 2.3 Kafaka

吞吐量很大，性能最高，但是不支持事务，适合于超大项目，搭建集群，是国际标准，天然分布式

单机Topic 数量过多时对吞吐量影响较大

### 2.4 RocketMQ

吞吐量很大，阿里开源的中间件，后续可能会停止维护或者不开源，所以暂时学习价值不大

单机Topic 数量过多时对吞吐量影响不大

## 三、应用场景

1. 跨系统数据传递
2. 高并发流量削峰
3. 数据分发和异步处理
4. 大数据分析与传递
5. 分布式事务

## 四、重要概念

生产者：消息提供者，负责向消息队列中发送数据

消费者：消息使用者，负责从消息队列中获取数据

消息队列：负责数据的接收、存储、发送，新能高于普通服务和技术

## 五、核心组成部分

### 5.1 消息的协议：

基于 TCP/IP 或 UDP 协议开发新的协议（amqp协议）

> 为何不用HTTP协议：
>
> 1. http 协议请求报文复杂，中间件追求高性能，尽量简洁快速
> 2. http 是短链接，请求可能被中断，中间件需要的是长连接协议

### 5.2 消息的持久化机制

### 5.3 消息的分发策略

#### 5.3.1 分发订阅

#### 5.3.2 轮询分发

#### 5.3.3 公平分发

#### 5.3.4 重发

#### 5.3.5 消息拉取

### 5.4 消息的高可用、高可靠

#### 5.4.1 集群模式 Master-slave 主从共享

#### 5.4.2 集群模式 Master-slave 主从同步

#### 5.4.3 集群模式 多主集群同步

#### 5.4.4 集群模式 多主集群转发

#### 5.4.5 集群模式 Master-slave 与 Breoker-cluster 组合方案（大型）

### 5.5 消息的容错机制

## 六、优缺点

### 6.1 优点

- **解耦**

  使用消息队列作为消息传输中介，将生产者和消费者两个系统进行解耦，消费者数量的变动生成者服务无需理会

- **削峰**

  访问高峰期，由于数据库处理受限、系统处理性能不够等，可能造成数据丢失，使用消息队列，可将高峰期请求暂存于消息队列，等待消费，从而保证请求不丢失

- **异步**

  当需要调用多个不想关服务时，可通过消息队列实现异步调用，从而提高响应速度

### 6.2 缺点

- **增加系统复杂度**

  消息的重复消费、消息传递的顺序性、消息丢失等

- **降低系统可用性**

  服务宕机、消息的高可用

- **数据一致性**

  下游多个服务数据操作数据时，某个服务操作失败